refactoring, move buffer handling to client side
